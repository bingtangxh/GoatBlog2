---
title: 如何在你的 Azure 虚拟机上安装 Windows Server 2012 R2 系统
categories: [教程]
author: bingtangxh
date: 2026-01-18 18:16:00
updated: 2026-01-18 18:16:00
---

# 此文章未写完
此文章介绍内容所需手把手部分较多，由于笔者除了关键步骤外均“凭感觉”操作，本文编纂完成需较长周期，且未必能覆盖到所有你实际操作时可能遇到的意外故障情况。一些笔者一笔带过的地方应该是笔者也不知道详细步骤，~反正到时候凭感觉操作也不会错~。

## 前置条件
- 一个有 Azure 订阅的账号，上面要有 x64 架构的虚拟机，该虚拟机要有一块硬盘
- （本文存在意义是让有 Azure 账号但是因为微软不让就不会用 Windows Server 2012 R2 系统的用户也能创建，没有 Azure 账号的话……恕我高冷范一点，看本文意义不大。）
- 自己电脑上要有 VMware Workstation Pro、Oracle Virtual Box 或者 Hyper-V 任意一个

{% folding 最好不要同时安装 VMW 和 Hyper-V %}
因为安装了 Hyper-V 之后，VMW 就会为所有的虚拟机都启用“侧通道缓解”，
这个东西似乎是用来暂时牺牲性能妥协解决一种名叫“侧通道”的安全漏洞，而它会大大降低虚拟机的性能，
你就会觉得你的 VMW 虚拟机明显变卡了很多。虽然在 VMW 的虚拟机设置里有一个选项是禁用“侧通道缓解”，
但也只能“好一点”，还是不如想办法将 Hyper-V 完全干掉。
而且这个选项也只是对单个虚拟机有用，没有“一键为全部虚拟机默认禁用”的选项。
而且想要干掉 Hyper-V 可不是那么简单，不是在“启用或关闭 Windows 功能”里取消勾选就行了，
而是要禁用好几个虚拟机或者 Hyper-V 相关的服务，VMW 虚拟机的性能才能变回正常状态。
{% endfolding %}

{% folding VMware Workstation Player 也可以 %}
但是因为 Player 在新建虚拟机的时候必须新建一个 vmdk 的虚拟硬盘，不能使用现有 vhd 虚拟硬盘，所以你只能先按照流程创建一个新建 vmdk 虚拟硬盘的虚拟机，创建好之后先不要开机，还要编辑虚拟机设置，将原来的硬盘删掉，再增加一个硬盘，选取那个 vhd 文件，这样让虚拟机用那个 vhd 文件，再开机。
{% endfolding %}

- Windows Server 2012 R2 x64 Standard 批量授权（VL）版本的系统镜像（可以在 [我告诉你](https://msdn.itellyou.cn)搜索下载，那些是 ed2k 网址，可以用[迅雷](https://www.xunlei.com)下载）
- 64GB 以上的连续可用硬盘空间（需要存放 64GB 的 vhd 文件，具体取决于你服务器硬盘大小）
- 持续可用的互联网连接

## 准备虚拟硬盘
1. 打开 Windows 7 及以上版本的“磁盘管理”，点击菜单栏的“操作”→创建 VHD。
2. 路径任意，但是虚拟硬盘格式一定要是 VHD，虚拟硬盘类型一定要是“固定大小”，虚拟硬盘大小取决于你 Azure 虚拟机的硬盘大小，最好完全一样。如果你是学生订阅的免费试用虚拟机，那一般是 64GB。新建硬盘需要 2 分钟左右。
3. 等待完成之后，将硬盘初始化为 GPT 分区表。然后一定要将虚拟硬盘“分离”。
   
## 准备你自己电脑上的虚拟机
这里是用 VMware Workstation Pro 16.0 举例。
这个具体的虚拟机软件步骤不太一样，总之就是新建一个虚拟机，硬盘用你刚才弄好的 vhd 文件，光盘就选 Windows Server 2012 R2 的 ISO 镜像文件。
如果是 VMware Workstation Pro，那就在创建虚拟机时一定要选择“自定义（高级）”，这样才能用你自己的 vhd 文件作为虚拟硬盘，不用现场新建 vmdk 虚拟硬盘。如果是 Player 请参照上文折叠的内容。
按照常见的虚拟机 Windows 安装步骤安装 Windows 或者设置 VMware 的简易安装配置即可。务必记得“要安装的 Windows”版本一定要选择“Standard 桌面体验”，尤其是有些时候你的操作向导步骤里“选择 Windows”版本只是一个下拉菜单，不显眼，就容易忘掉这一步，安装好了才发现不对劲。一般不需要输入产品密钥。但是设置的管理员密码要记住，因为待会还需要输入一次。
如下图，可以在创建虚拟机向导中使用“简易安装”，就是下图这一步要注意选取正确的 Windows 版本。
![](Screenshot_2026-01-19_214726.png)
下图这里就一定要选择“使用现有虚拟磁盘”，如果是 Player 就参照上面折叠内容说的。
![](Screenshot_2026-01-19_214940.png)
这里注意，浏览虚拟硬盘文件的时候，因为右下角“文件类型”默认只有 vmdk 这一个扩展名，所以你得手动改成“所有文件”。
![](Screenshot_2026-01-19_215007.png)
同样的， VMW 会询问要不要升级虚拟硬盘格式，咱们这里当然不升级，要不然就不是 vhd 格式了。
![](Screenshot_2026-01-19_215015.png)
（以上是 VMware Workstation 的设置步骤，其他虚拟机软件应该需要手动进行安装。此处恕不加详述，就是一般的 Windows 安装步骤。当然要记住你设置的密码，虽然最终就用不到了，但是你至少还需要用到一次）
然后在这里，用虚拟机软件给的方式向虚拟机发送按键 Ctrl+Alt+Delete ，可不要按你实际电脑的 Ctrl+Alt+Delete 啊，
![](Windows_Server_2012_R2-2026-01-19-21-55-12.png)
等到进桌面之后，只有一件事，打开命令提示符，运行下面这个指令：
`C:\Windows\system32\sysprep\sysprep.exe /oobe /generalize /shutdown`
然后你的这个系统会进行“通用化”操作，然后关机。
![](Windows_Server_2012_R2-2026-01-19-21-58-40)
注意这个步骤完成之后，系统会不加额外提示直接进入关机流程，所以你这期间虽然可以干别的操作，但是会被这个 sysprep 直接打断。

## 在 Azure 租户里新建存储账户和 Blob
在[Azure主页](https://portal.azure.com)点击“创建资源”，然后选择“存储账户”→“创建”。
![](Screenshot_2026-01-19_074956.png)
下面这里允不允许公用网络访问，我也不确定，就允许吧，难不成一个破 vhd 文件会有什么风险？（哎，话不敢说太满，但是总觉得这里如果禁止了会不会导致额外的麻烦或者错误）
![](Screenshot_2026-01-19_075520.png)
下图就是存储账户已经创建好了。
![](Screenshot_2026-01-19_075950.png)
创建大致步骤任意，创建完成后，在左侧点击“数据存储”→“容器”→“添加容器”。
![](Screenshot_2026-01-19_080124.png)


## 将 vhd 文件上传上去
（WIP……）
大概就是可以 Web 端直接上传（稳定性不好且无法断点续传，可能浏览器报错内存不足），或者给 Blob 新建一个能进行写入操作的 token ，再下载一个 Azure 还是什么的的[本地管理客户端](https://aka.ms/portalfx/downloadstorageexplorer)，用 token 连接上，再用这个客户端上传上去。
下图是那个下载“本地管理客户端”的地方。在首页点击“Download”，然后就来到了这里，咱们当然下载 Windows x64 了。
![](Screenshot_2026-01-19_080918.png)
然后安装这个资源管理器。可以是为本机所有用户安装，也可以只为当前用户安装。
安装好了之后，我们需要来到网页端，找到之前创建的存储账户，还是在左侧点击“数据存储”→“容器”，找到之前创建的容器，点开。
点开之后就是“容器”的设置界面了，点击左侧的“设置”→共享访问令牌，在右侧点开“权限”，我是一股脑全部勾上完事，可以确定“写入”和“列表”必须勾上。下面是设置开始和到期日期。允许的 IP 地址可以留空。
![](Screenshot_2026-01-20_190456.png)
创建好了之后，将这个 Blob SAS URL 复制下来。
![](Screenshot_2026-01-20_190646.png)



## 用这个 vhd 文件新建一个“映像”
（WIP……）

## 用这个“映像”创建一个新的虚拟机
有人可能要问，我已经建好虚拟机了，能不能就只换一下硬盘，让这个虚拟机从新硬盘启动？
我……不太会。我觉得应该用“新建虚拟机”这一整个步骤，这样才能在新建虚拟机的同时，顺带设置虚拟机上系统的用户名和密码这两个关键的东西。要不然，你那个系统的用户名密码都没有设置，怎么远程桌面连接那个虚拟机？只有用“新建虚拟机”这个流程顺带设置用户名密码。
对于学生订阅，虚拟机大小就是 B1s ，硬盘就是高级 SSD P6 64GB，这样才是免费的。
（WIP……）