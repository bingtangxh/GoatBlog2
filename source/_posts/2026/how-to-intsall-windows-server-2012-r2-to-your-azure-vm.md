---
title: 如何在你的 Azure 虚拟机上安装 Windows Server 2012 R2 系统
categories: [教程]
author: bingtangxh
date: 2026-01-18 18:16:00
updated: 2026-01-18 18:16:00
---

# 此文章未写完
此文章介绍内容所需手把手部分较多，由于笔者除了关键步骤外均“凭感觉”操作，本文编纂完成需较长周期，且未必能覆盖到所有你实际操作时可能遇到的意外故障情况。一些笔者一笔带过的地方应该是笔者也不知道详细步骤，~反正到时候凭感觉操作也不会错~。

## 前置条件
- 一个有 Azure 订阅的账号，上面要有 x64 架构的虚拟机，该虚拟机要有一块硬盘
- （本文存在意义是让有 Azure 账号但是因为微软不让就不会用 Windows Server 2012 R2 系统的用户也能创建，没有 Azure 账号的话……恕我高冷范一点，看本文意义不大。）
- 自己电脑上要有 VMware Workstation（下称“VMW”，不确定 Player 可不可以，建议 Pro）、Oracle Virtual Box 或者 Hyper-V 任意一个

{% folding 最好不要同时安装 VMW 和 Hyper-V %}
因为安装了 Hyper-V 之后，VMW 就会为所有的虚拟机都启用“侧通道缓解”，
这个东西似乎是用来暂时牺牲性能妥协解决一种名叫“侧通道”的安全漏洞，而它会大大降低虚拟机的性能，
你就会觉得你的 VMW 虚拟机明显变卡了很多。虽然在 VMW 的虚拟机设置里有一个选项是禁用“侧通道缓解”，
但也只能“好一点”，还是不如想办法将 Hyper-V 完全干掉。
而且这个选项也只是对单个虚拟机有用，没有“一键为全部虚拟机默认禁用”的选项。
而且想要干掉 Hyper-V 可不是那么简单，不是在“启用或关闭 Windows 功能”里取消勾选就行了，
而是要禁用好几个虚拟机或者 Hyper-V 相关的服务，VMW 虚拟机的性能才能变回正常状态。
{% endfolding %}

- Windows Server 2012 R2 x64 Standard 批量授权（VL）版本的系统镜像（可以在 [我告诉你](https://msdn.itellyou.cn)搜索下载，那些是 ed2k 网址，可以用[迅雷](https://www.xunlei.com)下载）
- 64GB 以上的连续可用硬盘空间（需要存放 64GB 的 vhd 文件，具体取决于你服务器硬盘大小）
- 持续可用的互联网连接
- 下载 Dism++ （会敲命令的话也可以不用）
- 下载 DiskGenius 或其他分区工具软件（会敲命令的话也可以不用，但是比较繁琐）

## 准备虚拟硬盘
1. 打开 Windows 7 及以上版本的“磁盘管理”，点击菜单栏的“操作”→创建 VHD。
2. 路径任意，但是虚拟硬盘格式一定要是 VHD，虚拟硬盘类型一定要是“固定大小”，虚拟硬盘大小取决于你 Azure 虚拟机的硬盘大小，最好完全一样。如果你是学生订阅的免费试用虚拟机，那一般是 64GB。新建硬盘需要 2 分钟左右。
3. 等待完成之后，将硬盘初始化为 GPT 分区表。
4. 接下来需要用到分区软件了，这里用 DiskGenius ，建议用最新版。先对那个虚拟硬盘“创建 ESP/MSR 分区”，创建一个 300MB 的 ESP 分区，再创建一个任意大小用来存放 Windows Server 系统的 NTFS 分区，可以是 16GB 或以上的任意大小，一般就是将硬盘空间用满。当然你还可以用 DiskGenius 的“快速分区”功能。其他分区软件则取决于具体使用方法。
5. 分区完成后，DiskGenius 应该会自动给 NTFS 分区分配盘符，给 ESP 分区默认不会分配盘符。如果你待会用 Dism++ 释放镜像，那不用管，分区软件可以关掉了；如果你要手动敲指令，那 ESP 分区你也需要手动分配一个盘符，而且释放镜像添加引导之后最好再手动删除 ESP 分区的盘符。
   
{% folding （不推荐）（WIP）用自带的 diskpart 指令新建分区 %}

（……WIP）相对较麻烦，不建议，除非你用的 IA64/ARM/ARM64 电脑，只能用 diskpart 指令，即使这样我也没写好，请谅解

{% endfolding %}

6. 用你自己喜欢或者能用的方法将 Windows Server 2012 R2 的 install.wim/esd 文件提取出来，可以是在 Windows 8 及以上双击挂载 ISO 或者用解压缩软件提取出来。
7. 用 Dism++ 将 wim/esd 文件释放到虚拟硬盘里，注意选择好 wim/esd 文件后、开始释放之前，切记选择 Windows 版本为 Windows Server 2012 R2 STANDARD 桌面体验（DESKTOP EXPERIENCE），切勿选择 DATACENTER 或者没有“桌面体验”的版本，并且一定要勾选“添加引导”。

{% folding 用命令行释放系统 %}

上一个步骤也可以用 dism 和 BCDBOOT 指令。

打开一个管理员身份的命令提示符，先输入：
`dism /get-imageinfo /imagefile:F:\sources\install.wim`
（F: 是我这里 ISO 镜像挂载出来的盘符，具体是你自己的路径）

看一下这个镜像里有哪些系统版本。那么第 2 个是咱们需要的版本，接下来释放镜像
`dism /apply-image /imagefile:F:\sources\install.wim /index:2 /applydir:E:\`
（E: 是虚拟硬盘里用来放系统的 NTFS 分区的盘符，具体是你自己的盘符）

释放过程所需时间不同情况差得远，我这里只用了 6 分钟。接下来输入
`bcdboot E:\Windows /s G: /f UEFI`
（G: 是虚拟硬盘里我手动给 ESP 分区分配的盘符，具体是你自己的盘符。这一步完成后最好再在分区软件里删掉 ESP 分区的盘符）

完成。

{% endfolding %}
   
3. 等待几分钟（可能更慢）进行释放。
4. （注意）完成之后，再打开磁盘管理，将虚拟硬盘“分离”。
   
## 准备你自己电脑上的虚拟机
这个具体的虚拟机软件步骤不太一样，总之就是新建一个虚拟机，硬盘用你刚才弄好的 vhd 文件，开机。
开机之后，先简单完成 OOBE 设置步骤，等到进桌面之后，只有一件事，打开命令提示符，运行下面这个指令：
`C:\Windows\system32\sysprep\sysprep.exe /generalize /shutdown`
然后你的这个系统会进行“通用化”操作，然后关机。

## 在 Azure 租户里新建存储账户和 Blob
（WIP……）

## 将 vhd 文件上传上去
（WIP……）
大概就是可以 Web 端直接上传（稳定性不好且无法断点续传，可能浏览器报错内存不足），或者给 Blob 新建一个能进行写入操作的 token ，再下载一个 Azure 还是什么的的[本地管理客户端](https://aka.ms/portalfx/downloadstorageexplorer)，用 token 连接上，再用这个客户端上传上去。

## 用这个 vhd 文件新建一个“映像”
（WIP……）

## 用这个“映像”创建一个新的虚拟机
有人可能要问，我已经建好虚拟机了，能不能就只换一下硬盘，让这个虚拟机从新硬盘启动？
我……不太会。我觉得应该用“新建虚拟机”这一整个步骤，这样才能在新建虚拟机的同时，顺带设置虚拟机上系统的用户名和密码这两个关键的东西。要不然，你那个系统的用户名密码都没有设置，怎么远程桌面连接那个虚拟机？只有用“新建虚拟机”这个流程顺带设置用户名密码。
对于学生订阅，虚拟机大小就是 B1s ，硬盘就是高级 SSD P6 64GB，这样才是免费的。
（WIP……）